--기존 테이블 만들기
CREATE TABLE EMP01(
EMPNO NUMBER(4),
ENAME VARCHAR2(10),
JOB VARCHAR2(9),
DEPTNO NUMBER(4)
); 
--기존 테이블에 제약 조건 추가하기
ALTER TABLE EMP01
ADD CONSTRAINT EMP01_EMPNO_PK PRIMARY KEY(EMPNO);

ALTER TABLE EMP01
ADD CONSTRAINT EMP01_DEPTNO_FK
FOREIGN KEY(DEPTNO) REFERENCES DEPT(DEPTNO); 
--
SELECT TABLE_NAME, CONSTRAINT_TYPE,
CONSTRAINT_NAME, R_CONSTRAINT_NAME
FROM USER_CONSTRAINTS
WHERE TABLE_NAME IN ('EMP01');
--기존 테이블에 NOT NULL 제약 조건을 추가하기
ALTER TABLE EMP01
MODIFY ENAME CONSTRAINT EMP01_ENAME_NN NOT NULL;
--제약 조건 제거하기
--기본 키 제약 조건을 제거
ALTER TABLE EMP01
DROP CONSTRAINT EMP01_EMPNO_PK;
--NOT NULL 제약 조건을 제거
ALTER TABLE EMP01
DROP CONSTRAINT EMP01_ENAME_NN;
--제약 조건으로 인한 컬럼 삭제 불가능 예(데이터 무결성을 보장받지 못함)
--기존 테이블 만들기
CREATE TABLE DEPT01(
DEPTNO NUMBER(2) CONSTRAINT DEPT01_DEPTNO_PK PRIMARY KEY,
DNAME VARCHAR2(14),
LOC VARCHAR2(13)
); 
CREATE TABLE EMP01(
EMPNO NUMBER(4)
CONSTRAINT EMP01_EMPNO_PK PRIMARY KEY ,
ENAME VARCHAR2(10)
CONSTRAINT EMP01_ENAME_NN NOT NULL,
JOB VARCHAR2(9),
DEPTNO NUMBER(4)
CONSTRAINT EMP01_DEPTNO_FK REFERENCES DEPT01(DEPTNO)
);

INSERT INTO EMP01 VALUES(7499, 'ALLEN', 'SALESMAN', 10);
INSERT INTO EMP01 VALUES(7369, 'SMITH', 'CLERK', 20); 
commit;
DELETE FROM DEPT01 WHERE DEPTNO=40;
rollback;
--외래키 제약조건 비활성화 하기
--EMP01 테이블에 지정한 외래키 제약 조건을 비활성화
ALTER TABLE EMP01
DISABLE CONSTRAINT EMP01_DEPTNO_FK; 
--비활성화 됐는지 확인
SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE,
TABLE_NAME, R_CONSTRAINT_NAME, STATUS
FROM USER_CONSTRAINTS
WHERE TABLE_NAME='EMP01';
--EMP01 테이블에 지정한 외래키 제약 조건을 활성화
--활성화 할려면 삭제했던 테이블을 다시 입력해야함
ALTER TABLE EMP01
ENABLE CONSTRAINT EMP01_DEPTNO_FK;
--CASCADE로 부모 테이블의 제약 조건을 비활성화하면
--이를 참조하고 있는 자식 테이블의 제약 조건도 같이 비활성화
ALTER TABLE DEPT01
DISABLE PRIMARY KEY CASCADE; 

SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE,
TABLE_NAME, R_CONSTRAINT_NAME, STATUS
FROM USER_CONSTRAINTS
WHERE TABLE_NAME IN('DEPT01', 'EMP01');

--CASCADE 옵션으로 제약조건 연속적으로 삭제
ALTER TABLE DEPT01
DROP PRIMARY KEY CASCADE;

SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE,
TABLE_NAME, R_CONSTRAINT_NAME, STATUS
FROM USER_CONSTRAINTS
WHERE TABLE_NAME IN('DEPT01', 'EMP01');